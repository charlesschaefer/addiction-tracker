<p-panel 
  header="Adicionar registro de Consumo"
  joyrideStep="usageAdd"
  title="Adicionar consumo"
  text="Sempre que você fizer o uso da substância, você pode usar a tela Adicionar Consumo para registrar o consumo. Reserve alguns segundos para pensar bem sobre qual o nível de fissura você está, quais foram os gatilhos que te levaram ao uso e como estão suas emoções."
  stepPosition="center"
>
  <p-toast />
  <form [formGroup]="usageForm" novalidate (ngSubmit)="onSubmit()">
    <div class="field">
      @for (substance of substances; track substance.name) {
        <label for="substance_{{substance.id}}">
          <p-radioButton 
            [value]=substance.id 
            inputId="substance_{{substance.id}}"
            formControlName="substance" 
            class="substance-radio-button"
          />
            {{ substance.name }}
        </label>
      }
    </div>
    <div class="field">
      <p-floatLabel>
        <input pInputText formControlName="quantity" type="number">
        <label for="quantity">Quantidade</label>
        <p-button icon="pi pi-plus" class="quantity-plus-button" [rounded]="true" (onClick)="increaseQuantity()" title="Adiciona um novo gatilho" />
      </p-floatLabel>
    </div>
    
    <div class="field">
      <p-floatLabel>
        <p-calendar
          inputId="datetime" 
          formControlName="datetime"
          [showTime]="true" 
          [hourFormat]="'24'" />
        <label for="datetime">Data e hora</label>
      </p-floatLabel>
    </div>
    <div class="field ">
      <div>Sentimento: </div><br />
      @for (sentiment of sentiments; track sentiment.name) {
        <p-radioButton 
            [value]=sentiment.id
            inputId="sentiment_{{sentiment.id}}"
            formControlName="sentiment" 
            class="sentiment-radio-button"
          />
        <label for="sentiment_{{sentiment.id}}" class="sentiment-radio-label">
            {{ sentiment.name }}
        </label>
      }
    </div>
    <div class="field " >
      <label>Fissura:</label>
      <div>
        <mat-slider showTickMarks class="craving-slider" min="1" max="10" step="1" discrete>
          <input matSliderThumb value="1" formControlName="craving">
        </mat-slider>
      </div>
    </div>
    <div class="field ">
      <p-floatLabel>
        <div style="display: flex;">
          <p-autoComplete 
            formControlName="trigger"
            [suggestions]="filteredTriggers"
            [virtualScroll]="true"
            [virtualScrollItemSize]="50" 
            [dropdown]="true"
            field="name"
            (completeMethod)="triggerSearch($event)" 
            [multiple]="true"
            id="trigger"
            joyrideStep="triggerAdd"
            title="Gatilhos"
            text="No começo não há nenhum gatilho registrado, mas você pode clicar no ícone ao lado para incluir os gatilhos que te levam a consumir a substância. Você pode escolher mais de um gatilho ao mesmo tempo. Alguns gatilhos comuns são stress, ansiedade, frustração, etc. Mas certamente você tem gatilhos únicos para o seu caso."
          />
          <label for="trigger">Gatilho</label>
          <p-button icon="pi pi-pencil" class="add-trigger-button" [rounded]="true" (onClick)="showDialog()" title="Adiciona um novo gatilho" />
        </div>
      </p-floatLabel>
    </div>
    <div class="field">
      <p-button type="submit">Salvar</p-button>
    </div>
  </form>
</p-panel>
<p-dialog header="Adicionar Gatilho" [modal]="true" [(visible)]="showAddTriggerDialog" [style]="{ width: '25rem' }">
  <form [formGroup]="triggerForm" novalidate>
    <div class="field">
        <label for="username" class="font-semibold w-6rem">Gatilho:</label>
        <input pInputText id="trigger" class="flex-auto" autocomplete="off" formControlName="name" />
    </div>
    <div class="field">
        <p-button label="Cancelar" severity="secondary" (click)="showAddTriggerDialog = false" />
        <p-button label="Salvar" (click)="saveTrigger()" />
    </div>
  </form>
  
</p-dialog>
  