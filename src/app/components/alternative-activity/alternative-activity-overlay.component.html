<div *ngIf="show" class="fixed inset-0 bg-black/60 dark:bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fadeIn">
  <div class="bg-white/95 dark:bg-gray-900/95 rounded-2xl shadow-2xl p-8 max-w-lg w-full border border-gray-100 dark:border-gray-800 animate-scaleIn overflow-y-auto max-h-[90vh]">
    <div class="mb-2 text-teal-500 text-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
      </svg>
    </div>
    <h3 class="text-2xl font-semibold text-gray-800 dark:text-gray-100 mb-3 text-center">
      {{ 'Try a Healthy Alternative' | transloco }}
    </h3>
    <p class="text-gray-600 dark:text-gray-400 mb-6 leading-relaxed text-center">
      {{ 'Instead of using, would you like to try one of these healthier activities? It might help reduce your craving and give you time to reflect.' | transloco }}
    </p>
    <div class="grid grid-cols-2 gap-4 mb-6">
      <button type="button" (click)="select(1)" class="flex flex-col items-center p-4 rounded-xl border border-teal-200 dark:border-teal-800 bg-teal-50 dark:bg-teal-900/40 hover:bg-teal-100 dark:hover:bg-teal-800 transition-all transform hover:scale-[1.03] active:scale-[0.98]">
        <div class="w-12 h-12 rounded-full bg-teal-100 dark:bg-teal-900 flex items-center justify-center mb-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-teal-600 dark:text-teal-300" fill="currentColor" viewBox="0 0 256 256">
            <path d="M24,104a12,12,0,0,1,0-24h96a12,12,0,0,0,0-24,15.07,15.07,0,0,0-10.26,4.45,12,12,0,0,1-17-16.9A39.34,39.34,0,0,1,120,32a36,36,0,0,1,0,72ZM208,68a39.34,39.34,0,0,0-27.3,11.55,12,12,0,0,0,17,16.9A15.07,15.07,0,0,1,208,92a12,12,0,0,1,0,24H32a12,12,0,0,0,0,24H208a36,36,0,0,0,0-72Zm-56,84H40a12,12,0,0,0,0,24H152a12,12,0,0,1,0,24,15.11,15.11,0,0,1-10.27-4.45,12,12,0,1,0-17,16.9A39.34,39.34,0,0,0,152,224a36,36,0,0,0,0-72Z"></path>
          </svg>
        </div>
        <span class="font-medium text-teal-700 dark:text-teal-200">{{ 'Breathing Exercise' | transloco }}</span>
        <span class="text-xs text-teal-600 dark:text-teal-300 mt-1">{{ '5 minutes' | transloco }}</span>
      </button>
      <button type="button" (click)="select(2)" class="flex flex-col items-center p-4 rounded-xl border border-blue-200 dark:border-blue-800 bg-blue-50 dark:bg-blue-900/40 hover:bg-blue-100 dark:hover:bg-blue-800 transition-all transform hover:scale-[1.03] active:scale-[0.98]">
        <div class="w-12 h-12 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center mb-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-600 dark:text-blue-300" fill="currentColor" viewBox="0 0 256 256">
            <path d="M134.88,6.17a12,12,0,0,0-13.76,0,259,259,0,0,0-42.18,39C50.85,77.43,36,111.62,36,144a92,92,0,0,0,184,0C220,66.64,138.36,8.6,134.88,6.17ZM128,212a68.07,68.07,0,0,1-68-68c0-33.31,20-63.37,36.7-82.71A249.35,249.35,0,0,1,128,31.11a249.35,249.35,0,0,1,31.3,30.18C176,80.63,196,110.69,196,144A68.07,68.07,0,0,1,128,212Zm49.62-52.4a52,52,0,0,1-34,34,12.2,12.2,0,0,1-3.6.55,12,12,0,0,1-3.6-23.45,28,28,0,0,0,18.32-18.32,12,12,0,0,1,22.9,7.2Z"></path>
          </svg>
        </div>
        <span class="font-medium text-blue-700 dark:text-blue-200">{{ 'Drink Water' | transloco }}</span>
        <span class="text-xs text-blue-600 dark:text-blue-300 mt-1">{{ '1 minute' | transloco }}</span>
      </button>
      <button type="button" (click)="select(3)" class="flex flex-col items-center p-4 rounded-xl border border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-900/40 hover:bg-green-100 dark:hover:bg-green-800 transition-all transform hover:scale-[1.03] active:scale-[0.98]">
        <div class="w-12 h-12 rounded-full bg-green-100 dark:bg-green-900 flex items-center justify-center mb-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-600 dark:text-green-300" fill="currentColor" viewBox="0 0 256 256">
            <path
              d="M212,180H156a12,12,0,0,0-12,12v12a40,40,0,0,0,80,0V192A12,12,0,0,0,212,180Zm-28,40a16,16,0,0,1-16-16h32A16,16,0,0,1,184,220Zm-84-64H44a12,12,0,0,0-12,12v12a40,40,0,0,0,80,0V168A12,12,0,0,0,100,156ZM72,196a16,16,0,0,1-16-16H88A16,16,0,0,1,72,196ZM72,12c-14.06,0-27.7,12.33-37.41,33.83-12.45,27.57-16.78,67.52,3.14,90.11a12,12,0,0,0,9,4.06H97.25a12,12,0,0,0,9-4.06c19.92-22.59,15.59-62.54,3.14-90.11C99.68,24.33,86,12,72,12ZM91.07,116H52.9c-6.71-12.13-7.67-35.45,3.56-60.3C63.16,40.85,70.28,36,72,36s8.82,4.85,15.53,19.7C98.73,80.55,97.77,103.87,91.07,116Zm67.68,48h50.54a12,12,0,0,0,9-4.06c19.92-22.59,15.59-62.54,3.14-90.11C211.72,48.33,198.08,36,184,36s-27.7,12.33-37.41,33.83c-12.45,27.57-16.78,67.52,3.14,90.11A12,12,0,0,0,158.75,164Zm9.74-84.3C175.2,64.85,182.32,60,184,60s8.82,4.85,15.52,19.7c11.23,24.85,10.27,48.17,3.56,60.3H164.93C158.23,127.87,157.27,104.55,168.49,79.7Z">
            </path>
          </svg>
        </div>
        <span class="font-medium text-green-700 dark:text-green-200">{{ 'Take a Walk' | transloco }}</span>
        <span class="text-xs text-green-600 dark:text-green-300 mt-1">{{ '10-15 minutes' | transloco }}</span>
      </button>
      <button type="button" (click)="select(4)" class="flex flex-col items-center p-4 rounded-xl border border-purple-200 dark:border-purple-800 bg-purple-50 dark:bg-purple-900/40 hover:bg-purple-100 dark:hover:bg-purple-800 transition-all transform hover:scale-[1.03] active:scale-[0.98]">
        <div class="w-12 h-12 rounded-full bg-purple-100 dark:bg-purple-900 flex items-center justify-center mb-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-purple-600 dark:text-purple-300" fill="currentColor" viewBox="0 0 256 256">
            <path
              d="M128,84A36,36,0,1,0,92,48,36,36,0,0,0,128,84Zm0-48a12,12,0,1,1-12,12A12,12,0,0,1,128,36Zm100,72a12,12,0,0,1-12,12H140v16.09L188.73,157A12,12,0,0,1,196,168v48a12,12,0,0,1-24,0V175.91l-41.67-17.86L56,224.92A12,12,0,0,1,40,207.08l76-68.42V120H40a12,12,0,0,1,0-24H216A12,12,0,0,1,228,108Z">
            </path>
          </svg>
        </div>
        <span class="font-medium text-purple-700 dark:text-purple-200">{{ 'Stretching' | transloco }}</span>
        <span class="text-xs text-purple-600 dark:text-purple-300 mt-1">{{ '5 minutes' | transloco }}</span>
      </button>
      <button type="button" (click)="select(5)" class="flex flex-col items-center p-4 rounded-xl border border-yellow-200 dark:border-yellow-800 bg-yellow-50 dark:bg-yellow-900/40 hover:bg-yellow-100 dark:hover:bg-yellow-800 transition-all transform hover:scale-[1.03] active:scale-[0.98]">
        <div class="w-12 h-12 rounded-full bg-yellow-100 dark:bg-yellow-900 flex items-center justify-center mb-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-yellow-600 dark:text-yellow-300" fill="currentColor" viewBox="0 0 256 256">
            <path d="M128,108a52,52,0,1,0,52,52A52.06,52.06,0,0,0,128,108Zm0,80a28,28,0,1,1,28-28A28,28,0,0,1,128,188Zm86.76-58.68L185,45.17A60,60,0,0,0,71.42,44h0l-29.5,83.46a92,92,0,1,0,172.84,1.86ZM128,228a68.05,68.05,0,0,1-63.59-92.15c0-.09.07-.18.1-.26L94.05,52h0a36,36,0,0,1,68.17.78l.09.27,29.82,84.28A68,68,0,0,1,128,228Z"></path>
          </svg>
        </div>
        <span class="font-medium text-yellow-700 dark:text-yellow-200">{{ 'Healthy Snack' | transloco }}</span>
        <span class="text-xs text-yellow-600 dark:text-yellow-300 mt-1">{{ '5 minutes' | transloco }}</span>
      </button>
      <button type="button" (click)="select(6)" class="flex flex-col items-center p-4 rounded-xl border border-pink-200 dark:border-pink-800 bg-pink-50 dark:bg-pink-900/40 hover:bg-pink-100 dark:hover:bg-pink-800 transition-all transform hover:scale-[1.03] active:scale-[0.98]">
        <div class="w-12 h-12 rounded-full bg-pink-100 dark:bg-pink-900 flex items-center justify-center mb-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-pink-600 dark:text-pink-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
          </svg>
        </div>
        <span class="font-medium text-pink-700 dark:text-pink-200">{{ 'Call a Friend' | transloco }}</span>
        <span class="text-xs text-pink-600 dark:text-pink-300 mt-1">{{ '5-10 minutes' | transloco }}</span>
      </button>
    </div>
    <div class="flex justify-center mt-4">
      <button type="button" (click)="onClose.emit()" class="px-6 py-2 border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 text-gray-700 dark:text-gray-200 rounded-full hover:bg-gray-50 dark:hover:bg-gray-800 transition-all hover:border-gray-300 dark:hover:border-gray-600 transform hover:scale-105 active:scale-95">
        {{ 'Skip for now' | transloco }}
      </button>
    </div>
    <div class="mt-6 pt-4 border-t border-gray-100 dark:border-gray-800 text-center">
      <p class="text-sm text-gray-500 dark:text-gray-400 mb-3">
        {{ "We'll track which alternatives work best for you over time." | transloco }}
      </p>
      <div *ngIf="personalizedRecommendation" class="bg-purple-50 dark:bg-purple-900/40 rounded-lg p-3 mt-2 border border-purple-100 dark:border-purple-800">
        <p class="text-sm font-medium text-purple-700 dark:text-purple-300 mb-1">
          {{ 'Your most effective alternative:' | transloco }}
        </p>
        <div class="flex items-center justify-center">
          <span class="font-medium text-purple-800 dark:text-purple-100">
            {{ personalizedRecommendation?.name }}
          </span>
          <span class="ml-2 bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 text-xs px-2 py-1 rounded-full">
            {{ personalizedRecommendation?.successRate }}% success rate
          </span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Processing Activity Dialog -->
<div *ngIf="showProcessingDialog" class="fixed inset-0 flex items-center justify-center z-40 bg-black/60 backdrop-blur-sm animate-fadeIn">
  <div class="bg-white rounded-2xl shadow-xl p-8 max-w-md w-full text-center animate-scaleIn">
    <div class="mb-6 flex justify-center">
      <div class="h-16 w-16 rounded-full bg-indigo-100 flex items-center justify-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-indigo-600 animate-pulse" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
        </svg>
      </div>
    </div>
    <h3 class="text-xl font-semibold text-gray-800 mb-2">{{ 'Processing your activity' | transloco }}</h3>
    <p class="text-gray-600 mb-6">{{ 'Hang tight! We\'re preparing this activity for you...' | transloco }}</p>
    <div class="flex justify-center">
      <div class="w-16 h-16 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin"></div>
    </div>
  </div>
</div>

<!-- Breathing Exercise Component -->
<div *ngIf="showBreathingExercise" class="fixed inset-0 flex items-center justify-center z-40 bg-black/60 backdrop-blur-sm animate-fadeIn">
  <div class="bg-white rounded-2xl shadow-xl p-8 max-w-md w-full text-center animate-scaleIn relative">
    <button
      (click)="skipBreathingExercise()"
      class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 p-1.5 rounded-full hover:bg-gray-100/80 transition-all"
      [ariaLabel]="'Skip breathing exercise' | transloco "
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="h-6 w-6"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M6 18L18 6M6 6l12 12"
        />
      </svg>
    </button>
    
    <div class="mb-4 flex justify-center">
      <div class="h-16 w-16 rounded-full bg-teal-100 flex items-center justify-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-teal-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15.536a5 5 0 017.072 0m-9.9-2.828a9 9 0 0112.728 0"/>
        </svg>
      </div>
    </div>
    
    <h3 class="text-xl font-semibold text-gray-800 mb-2">{{ 'Breathing Exercise' | transloco }}</h3>
    <p class="text-gray-600 mb-8">{{ 'Follow along with this breathing pattern to help calm your mind.' | transloco }}</p>
    
    <div class="flex flex-col items-center mb-6">
      <div class="relative mb-4">
        <!-- Animated breathing circle -->
        <!-- [ngClass]="getBreathingAnimationClass()" -->
        <div 
          class="w-48 h-48 rounded-full flex items-center justify-center transition-transform duration-500 ease-in-out transform"
          style="border: 8px solid #0d9488; background-color: rgba(204, 251, 241, 0.2);"
        >
          <div class="text-teal-700 font-semibold text-2xl">{{currentBreath}}/{{totalBreaths}}</div>
        </div>
        
        <!-- Progress indicator -->
        <div class="absolute top-0 left-0 w-full h-full">
          <svg viewBox="0 0 100 100" class="w-full h-full" style="transform: rotate(-90deg);">
            <circle 
              cx="50" cy="50" r="44" 
              stroke="rgba(204, 251, 241, 0.3)" 
              stroke-width="8" 
              fill="none"
            />
            <circle 
              cx="50" cy="50" r="44" 
              stroke="#0d9488" 
              stroke-width="8" 
              fill="none"
              stroke-dasharray="276.5"
              [attr.stroke-dashoffset]="276.5 - (276.5 * breathingProgress / 100)"
              style="transition: stroke-dashoffset 0.1s linear;"
            />
          </svg>
        </div>
      </div>
      
      <!-- Breathing instruction -->
      <div class="mt-4 h-8">
        <p class="text-teal-700 font-medium text-lg">{{ getBreathingInstruction() }}</p>
      </div>
    </div>
    
    <div class="mb-6">
      <div class="w-full bg-gray-100 h-2 rounded-full overflow-hidden">
        <div class="bg-teal-500 h-full rounded-full" [style.width.%]="(currentBreath - 1 + breathingProgress / 100) / totalBreaths * 100"></div>
      </div>
      <p class="text-sm text-gray-600 mt-2">{{ 'Progress:' | transloco }} {{ Math.floor((currentBreath - 1 + breathingProgress / 100) / totalBreaths * 100) }}%</p>
    </div>
    
    <button
      (click)="skipBreathingExercise()"
      class="px-5 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors"
    >
      {{ 'Skip to end' | transloco }}
    </button>
  </div>
</div>

<!-- Activity Feedback Dialog -->
<div *ngIf="showFeedbackDialog" class="fixed inset-0 flex items-center justify-center z-40 bg-black/60 backdrop-blur-sm animate-fadeIn">
  <div class="bg-white rounded-2xl shadow-xl p-8 max-w-md w-full animate-scaleIn">
    <div class="mb-6 flex justify-center">
      <div class="h-16 w-16 rounded-full bg-indigo-100 flex items-center justify-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905a3.61 3.61 0 01-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5"/>
        </svg>
      </div>
    </div>
    <h3 class="text-xl font-semibold text-gray-800 mb-2">{{ 'Did it help?' | transloco }}</h3>
    <p class="text-gray-600 mb-6">{{ 'Let us know if' | transloco }} <span class="font-medium text-indigo-600">{{selectedActivity?.name}}</span> {{ 'helped reduce your craving' | transloco }}</p>
    
    <div class="mb-6">
      <label class="block text-sm font-medium text-gray-700 mb-2">{{ 'Share your experience (optional)' | transloco }}</label>
      <textarea 
        [(ngModel)]="feedbackMessage" 
        name="feedbackMessage"
        rows="3" 
        class="w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
        [placeholder]="'What did you learn from this experience?' | transloco"
      ></textarea>
    </div>
    
    <div class="grid grid-cols-2 gap-4">
      <button
        (click)="handleSubmitFeedback(true)"
        class="py-3 px-4 bg-green-600 hover:bg-green-700 text-white font-medium rounded-lg transition-colors shadow-sm flex items-center justify-center"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
          <path d="M2 10.5a1.5 1.5 0 113 0v6a1.5 1.5 0 01-3 0v-6zM6 10.333v5.43a2 2 0 001.106 1.79l.05.025A4 4 0 008.943 18h5.416a2 2 0 001.962-1.608l1.2-6A2 2 0 0015.56 8H12V4a2 2 0 00-2-2 1 1 0 00-1 1v.667a4 4 0 01-.8 2.4L6.8 7.933a4 4 0 00-.8 2.4z" />
        </svg>
        {{ 'Yes, it helped' | transloco }}
      </button>
      <button
        (click)="handleSubmitFeedback(false)"
        class="py-3 px-4 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg transition-colors shadow-sm flex items-center justify-center"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
          <path d="M18 9.5a1.5 1.5 0 11-3 0v-6a1.5 1.5 0 013 0v6zM14 9.667v-5.43a2 2 0 00-1.105-1.79l-.05-.025A4 4 0 0011.055 2H5.64a2 2 0 00-1.962 1.608l-1.2 6A2 2 0 004.44 12H8v4a2 2 0 002 2 1 1 0 001-1v-.667a4 4 0 01.8-2.4l1.4-1.866a4 4 0 00.8-2.4z" />
        </svg>
        {{ "No, it didn't" | transloco }}
      </button>
    </div>
    
    <button
      (click)="handleCancelFeedback()"
      class="mt-4 w-full py-2 border border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-50 transition-colors flex items-center justify-center"
    >
      {{ 'Cancel' | transloco }}
    </button>
  </div>
</div>
